<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Card Move</title>
  <style>
    * {
      padding: 0px;
      margin: 0px;
      box-sizing: border-box;
    }

    [card-move-area] {
      border: 1px solid black;
      margin: 10px;
      display: flex;
      min-height: 160px;
      align-items: center;
    }

    .card,
    .card-from,
    .card-to {
      width: 95.61px;
      height: 140px;
    }

    .card-from {
      background-color: transparent;
    }

    .card-to {
      background-color: lightgreen;
    }

    .card {
      background-size: cover;
      user-select: none;
    }
  </style>
</head>

<body>
  <div card-move-area>
    <div class="card-move"
      style="background-image: url(https://storage.googleapis.com/ygoprodeck.com/pics_small/97631303.jpg);"></div>
    <div class="card-move"
      style="background-image: url(https://storage.googleapis.com/ygoprodeck.com/pics_small/86509711.jpg);"></div>
    <div class="card-move"
      style="background-image: url(https://storage.googleapis.com/ygoprodeck.com/pics_small/89448140.jpg);"></div>
  </div>
  <div card-move-area>
    <div class="card-move"
      style="background-image: url(https://storage.googleapis.com/ygoprodeck.com/pics_small/36045450.jpg);"></div>
    <div class="card-move"
      style="background-image: url(https://storage.googleapis.com/ygoprodeck.com/pics_small/50237654.jpg);"></div>
  </div>
</body>

<script>
  const CARD_MOVE = {
    cardMoveAreas: null
  };

  const createCardTo = () => {
    const el = document.createElement('div');
    el.classList.add('card-to');
    return el;
  }

  const itemMouseDown = event => {
    event.target.addEventListener('mousemove', itemMouseMove);
    event.target.addEventListener('mouseup', itemMouseUp);
    event.target.style.top = `${event.target.getBoundingClientRect().top}px`;
    event.target.style.left = `${event.target.getBoundingClientRect().left}px`;
    event.target.style.position = 'fixed';
    event.target.style.zIndex = 10;
  }

  const itemMouseMove = event => {
    event.target.style.top = `${event.y - event.target.clientHeight / 2}px`;
    event.target.style.left = `${event.x - event.target.clientWidth / 2}px`;
    const dropAreaItem = document.elementsFromPoint(event.clientX, event.clientY).find(
      element =>
        (
          element.hasAttribute('card-move-item') &&
          element.getAttribute('card-move-item-id') !== event.target.getAttribute('card-move-item-id')
        ) ||
        element.classList.contains('card-to')
    );
    if (dropAreaItem) {
      if (!dropAreaItem.classList.contains('card-to')) {
        document.querySelectorAll('.card-to').forEach(e => e.remove());
        dropAreaItem.parentElement.insertBefore(createCardTo(), dropAreaItem);
      }
    } else {
      const area = document.elementsFromPoint(event.clientX, event.clientY).find(element => element.hasAttribute('card-move-area'));
      document.querySelectorAll('.card-to').forEach(e => e.remove());
      if (area) {
        area.appendChild(createCardTo());
      }
    }
  }

  const itemMouseUp = event => {
    event.target.removeEventListener('mousemove', itemMouseMove);
    event.target.removeEventListener('mouseup', itemMouseUp);
    const dropArea = document.elementsFromPoint(event.clientX, event.clientY).find(element => element.hasAttribute('card-move-area'));
    const areas = {
      from: null,
      to: null
    }
    if (dropArea) {
      const dropTo = document.elementsFromPoint(event.clientX, event.clientY).find(
        element =>
          element.classList.contains('card-to') ||
          (
            element.hasAttribute('card-move-item') &&
            element.getAttribute('card-move-item-id') != event.target.getAttribute('card-move-item-id')
          )
      );
      event.target.setAttribute('card-move-area-id', dropArea.getAttribute('card-move-area-id'))
      areas.from = event.target.parentElement;
      if (dropTo) {
        dropArea.insertBefore(event.target, dropTo);
      } else {
        dropArea.appendChild(event.target);
      }
      areas.to = event.target.parentElement;
    }
    event.target.style.removeProperty('top');
    event.target.style.removeProperty('left');
    event.target.style.removeProperty('position');
    event.target.style.removeProperty('z-index');
    document.querySelectorAll('.card-to').forEach(e => e.remove())
    if (areas.from && areas.to) {
      reorderAreaIds(areas.from);
      reorderAreaIds(areas.to);
    }
  }

  const reorderAreaIds = area => {
    for (let i = 0; i < area.children.length; i++) {
      const child = area.children[i];
      child.setAttribute('card-move-item-id', `${area.getAttribute('card-move-area-id')}-${i}`)
    }
  }

  const initArea = (area, areaId) => {
    for (let i = 0; i < area.children.length; i++) {
      const child = area.children[i];
      child.setAttribute('card-move-item', true)
      child.setAttribute('card-move-area-id', areaId)
      child.setAttribute('card-move-item-id', `${areaId}-${i}`)
      child.addEventListener('mousedown', itemMouseDown);
    }
  }

  const initCardMove = () => {
    CARD_MOVE.cardMoveAreas = document.querySelectorAll('[card-move-area]');
    CARD_MOVE.cardMoveAreas.forEach((area, i) => {
      area.setAttribute('card-move-area-id', i);
      initArea(area, i);
    });
  };

  (() => { initCardMove(); })();
</script>

</html>
